# Matlab微分方程求解

## 1.符号介绍

D: 微分符号,

D2:表示二阶微分，

D3:表示三阶微分，

以此类推。

## 2.符号解

### dsolve函数

###### 1.定义

用于==求**常**微分方程组的精确解==，也称为常微分方程的符号解。如果没有初始条件或边界条件，则求出通解；如果有，则求出特解。

注：未知函数是一元函数的微分方程称作常微分方程，未知数是多元函数的微分方程称作偏微分方程。

###### 2.函数格式

$Y=dsolve('eq1,eq2,eq3......','cond1,cond2,cond3......','Name')$

符号说明：

'eq1,eq2,eq3......'：表示微分方程或微分方程组

'cond1,cond2,cond3......':表示初始条件或边界条件

'Name'：表示变量，没有指定时，matlab默认为t

###### 3.例程

1.求解微分方程：$\frac{\partial y}{\partial x}=3x^2$

```matlab
dsolve('Dy=3*x^2','x')
```

2.求解初始条件的微分方程：$\frac{\partial y}{\partial x}=3x^2,\quad y_{|x=0}$

```matlab
dsolve('Dy=3*x^2','y(0)=2','x')
```

## 3.数值解

### ode函数

###### 1.定义

ode是Matlab专门用于解微分方程的功能函数。该求解器有变步长（variable-step）和定步长（fixed-step）两种类型。不同类型有着不同的求解器，具体说明如下图。 

| ode函数           |                                                  |                                  |
| ----------------- | ------------------------------------------------ | -------------------------------- |
| 非刚性ode求解命令 |                                                  |                                  |
| 求解器solver      | 功能                                             | 说明                             |
| ode45             | 一步算法：4、5阶龙格库塔方程：累计截断误差(Δx)^5 | 大部分尝试的首选算法             |
| ode23             | 一步算法：2、3阶龙格库塔方程：累计截断误差(Δx)^3 | 适用于精度较低的情形             |
| ode113            | 多步算法：Adams                                  | 计算时间比ode45短                |
| 刚性ode求解命令   |                                                  |                                  |
| ode23t            | 梯形算法                                         | 适度刚性情形                     |
| ode15s            | 多步法：Gear’s反向数值微分：精度中等             | 若ode45失效时，可以尝试使用      |
| ode23s            | 一步法：2阶Rosebrock算法：精度低                 | 当精度较低时，计算时间比ode15s短 |
| ode23tb           | 梯形算法：精度低                                 | 当精度较低时，计算时间比ode15s短 |

注：==ode45是解决数值解问题的首选方法==，若长时间没结果，应该就是刚性的，可换用==ode15s==试试。

###### 2.函数格式

$$
[T,Y] = ode45({’}odefun{’},tspan,y0)
$$

$$
[T,Y] = ode45(’odefun’,tspan,y0,options)
$$

$$
[T,Y,TE,YE,IE] = ode45(’odefun’,tspan,y0,options)
$$

$$
sol = ode45(’odefun’,[t0\quad tf],y0...)
$$

符号说明: 

​     odefun：函数句柄,可以是函数文件名,匿名函数句柄或内联函数名
​     tspan：求解区间 [t0  tf]，或者一系列散点[t0,t1,...,tf]
​     y0：初始值向量
​     T：返回列向量的时间点
​     Y：返回对应T的求解列向量
​     options：求解参数设置,可以用odeset在计算前设定误差,输出参数,事件等
​     TE：事件发生时间
​     YE：事件发生时之答案
​     IE：事件函数消失时之指针i

###### 3.微分方程标准化

==利用ode45求解高阶微分方程时，需要做变量替换。==

微分方程为
$$
F(y,y',y'',......y^{n},t)=0
$$
初始条件
$$
y(t0)=c_0,y'(t_0)=c1,......y^{n-1}(t_0)=c_{n-1}
$$
首先做变量替换 
$$
x(1)=y,x(2)=y',x(3)=y'',......x(n)=y^{(n-1)}
$$
原微分方程可以转换为下面的微分方程组的格式:
$$
\begin{cases} dx(1)=x(2)\\dx(2)=x(3)\\......\\dx(n-1)=x(n)=f(t,x(n-1),......x(s),x(1)) \end{cases}
$$
下面就可以利用转换好的微分方程组来编写odefun函数。

###### 4.例程

求解常微分方程：

在t=[3.9 , 4]区间内求解常微分方程$y''=-ty+e^ty'+3sin2t，\quad y_{|t=3}=8,\quad y_{|t=3}'=2$



首先要写odefun函数

令  x(1)=y  ,  x(2)=y'  ,  那么微分方程可以转换为

$dx(1) = y' = x(2)$

$dx(2) = -tx(1) + e^tx(2) + 3sin2t$

```matlab
function dx=odefun(t,x)
dx=zeros(2,1);
dx(1)=x(2);
dx(2)=-t*x(1)+exp(t)*x(2)+3*sin(2*t);
end
```

再编写主函数

```matlab
%% ode45求解
tspan=[3.9 4];  %求解区间
y0=[8 2];  %初值
[t,x]=ode45('odefun',tspan,y0);
%% 画图
plot(t,x(:,1),'-o',t,x(:,2),'-*')
title('y''''=-t*y+exp(t)*y''+3*sin(2*t)')
xlabel('t')
ylabel('y')
```

注：需要注意的是，ode45的运行结果以列向量形式给出。因此在本例中，x的第一列为y，第二列为y’。如果遇到变量不是列向量形式的，可以考虑利用reshape函数做矩阵变换。























































